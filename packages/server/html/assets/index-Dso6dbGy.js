import{r as f,e as w,s as k,f as z,j as s,N as E,A as y,g as O,h as D}from"./index-tUupWX2Z.js";import{u as j,a as h,C as U,E as V,D as M,b as C,P as F}from"./index-VXBAKJTl.js";import{F as c,I as x}from"./index-D2Go8QlY.js";import{M as v}from"./index-bGRvYwQj.js";import{B as P}from"./index-CE_wiyHQ.js";const L=({actionRef:t,onFinish:l})=>{const[o]=c.useForm(),[i,u]=f.useState(),r=!!i,[N,{open:g,close:m}]=j(),p=f.useMemo(()=>r?i:{rateLimitEnabled:!1,rateLimitCount:1,rateLimitDuration:60},[r,i]),b=()=>{m(),o.resetFields()},d=h(async()=>{const n=await o.validateFields();if(!n)return!1;let e=!0;if(r){const{error:a}=await w(i.id,n);a||(k.success("Organization updated successfully"),o.resetFields()),e=!a}else{const{error:a}=await z(n);a||(k.success("Organization created successfully"),o.resetFields()),e=!a}return e&&l&&(m(),l()),e},{manual:!0});return f.useEffect(()=>{t!=null&&t.current||(t.current={openModal:n=>{u(n),o.setFieldsValue(n),g()}})},[o,g]),s.jsxDEV(v,{title:r?"Edit organization":"Create organization",open:N,onCancel:b,okButtonProps:{htmlType:"submit",loading:d.loading},onOk:d.run,children:s.jsxDEV(c,{labelCol:{span:5},form:o,initialValues:p,children:[s.jsxDEV(c.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Please input organization name!"}],children:s.jsxDEV(x,{placeholder:"Organization name",maxLength:12},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/components/EditOrganizationModal.tsx",lineNumber:97,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/components/EditOrganizationModal.tsx",lineNumber:96,columnNumber:9},void 0),s.jsxDEV(c.Item,{label:"Gitea URL",name:"giteaUrl",rules:[{required:!0,message:"Please input organization name!"}],children:s.jsxDEV(x,{placeholder:"eg: https://gitea.com"},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/components/EditOrganizationModal.tsx",lineNumber:100,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/components/EditOrganizationModal.tsx",lineNumber:99,columnNumber:11},void 0),s.jsxDEV(c.Item,{label:"Gitea api token",name:"giteaToken",tooltip:"https://docs.gitea.com/development/api-usage",children:s.jsxDEV(x,{placeholder:"Gitea api token"},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/components/EditOrganizationModal.tsx",lineNumber:103,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/components/EditOrganizationModal.tsx",lineNumber:102,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/components/EditOrganizationModal.tsx",lineNumber:95,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/components/EditOrganizationModal.tsx",lineNumber:85,columnNumber:5},void 0)},{useModal:q}=v,$=()=>{var b,d,n;const[t,l]=q(),[o,i]=k.useMessage(),u=f.useRef(),r=h(async()=>{const{error:e,data:a}=await O();return e?[]:a}),N=e=>{t.confirm({title:`Delete organization "${e.name}"?`,content:"This operation is irreversible.",okButtonProps:{danger:!0},onOk:async()=>{const{error:a}=await D(e.id);a||(o.success("Organization deleted successfully."),r.refresh())}})},g=()=>{var e;(e=u.current)==null||e.openModal()},m=e=>{var a;(a=u.current)==null||a.openModal(e)},p=s.jsxDEV(P,{type:"dashed",className:"flex items-center",onClick:()=>g(),children:[s.jsxDEV(F,{},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:51,columnNumber:7},void 0)," Create an Organization"]},void 0,!0,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:50,columnNumber:5},void 0);return s.jsxDEV(s.Fragment,{children:[!!((b=r.data)!=null&&b.length)&&p,s.jsxDEV("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(d=r.data)==null?void 0:d.map(e=>s.jsxDEV(U,{title:s.jsxDEV(E,{className:"text-foreground",to:`${y.Organizations}/${e.id}`,children:e.name},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:62,columnNumber:20},void 0),actions:[s.jsxDEV(V,{className:"cursor-pointer",onClick:()=>m(e)},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:64,columnNumber:15},void 0),s.jsxDEV(M,{className:"!hover:text-red-500 cursor-pointer",onClick:()=>N(e)},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:65,columnNumber:15},void 0)],children:s.jsxDEV("div",{className:"text-sm",children:e.giteaUrl},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:68,columnNumber:13},void 0)},e.id,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:60,columnNumber:11},void 0))},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:58,columnNumber:7},void 0),!r.loading&&((n=r.data)==null?void 0:n.length)===0&&s.jsxDEV(C,{className:"my-10 flex flex-col items-center justify-center",description:"No organizations found.",children:p},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:73,columnNumber:9},void 0),s.jsxDEV(L,{actionRef:u,onFinish:()=>r.refresh()},void 0,!1,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:77,columnNumber:7},void 0),l,i]},void 0,!0,{fileName:"/Users/erguotou/workspace/erguotou/sync-gitea-server/packages/web/src/pages/dashboard/organizations/index.tsx",lineNumber:56,columnNumber:5},void 0)};export{$ as default};
